# ì›¹ ë¹Œë” í”„ë¡œì íŠ¸ í•µì‹¬ ê¸°ëŠ¥ ë¶„ì„

## í”„ë¡œì íŠ¸ ê°œìš”

ì´ Next.js ì›¹ ë¹Œë”ëŠ” Feature-Sliced Design (FSD) ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë¹„ì£¼ì–¼ ì›¹ ì—ë””í„°ì…ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ:**
- Frontend: Next.js 15.5.2, React 19.1.0, TypeScript
- ìŠ¤íƒ€ì¼ë§: Tailwind CSS 4 + ì¸ë¼ì¸ CSS ìŠ¤íƒ€ì¼
- ìƒíƒœê´€ë¦¬: Zustand
- ë“œë˜ê·¸ ì•¤ ë“œë¡­: @dnd-kit
- UI ì»´í¬ë„ŒíŠ¸: shadcn/ui (Radix UI ê¸°ë°˜)

---

## 1. Add Element ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì‹œìŠ¤í…œ

### ğŸ“ í•µì‹¬ íŒŒì¼
- `src/widgets/layout.tsx` - ë“œë¡­ë‹¤ìš´ UI êµ¬í˜„
- `src/shared/lib/element-factory.ts` - ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„± ë¡œì§
- `src/processes/editor-store.ts` - ìƒíƒœ ê´€ë¦¬

### ğŸ”„ ì‘ë™ ì›ë¦¬ (ì‹¤ì œ ì½”ë“œ ê¸°ì¤€)

`layout.tsx`ì˜ UI, `element-factory.ts`ì˜ ìƒì„± ë¡œì§, `editor-store.ts`ì˜ ìƒíƒœ ê´€ë¦¬ê°€ í•¨ê»˜ ë™ì‘í•©ë‹ˆë‹¤.

```typescript
// 1. ì‚¬ìš©ìê°€ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ì—˜ë¦¬ë¨¼íŠ¸ íƒ€ì… ì„ íƒ
// íŒŒì¼: src/widgets/layout.tsx
const elementTypes: { type: ElementType; label: string; icon: React.ReactNode; }[] = [
  { type: "text", label: "í…ìŠ¤íŠ¸", icon: <Type className="w-4 h-4" /> },
  { type: "image", label: "ì´ë¯¸ì§€", icon: <Image className="w-4 h-4" /> },
  // ... ë” ë§ì€ íƒ€ì…ë“¤
];

// 2. handleAddElement í•¨ìˆ˜ê°€ í˜¸ì¶œë¨
// íŒŒì¼: src/widgets/layout.tsx
const handleAddElement = (type: ElementType) => {
  const element = createElement(type, generateId());
  addElement(element);
};

// 3. createElementê°€ íƒ€ì…ì— ë§ëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œ ìƒˆ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
// íŒŒì¼: src/shared/lib/element-factory.ts
export function createElement(
  type: ElementType,
  id: string,
  x: number = 100,
  y: number = 100,
  options?: Partial<Element>
): Element {
  const baseElement = { id, x, y, zIndex: 0, /* ... */ };

  switch (type) {
    case "text":
      return {
        ...baseElement,
        type: "text",
        width: "auto",
        height: "auto",
        content: "ìƒˆ í…ìŠ¤íŠ¸",
        fontSize: 14,
        fontFamily: "Inter",
        color: "hsl(var(--foreground))",
        // ...ê¸°íƒ€ í…ìŠ¤íŠ¸ ì†ì„±ë“¤
      } as TextElement;
    // ... ë‹¤ë¥¸ íƒ€ì…ë“¤
  }
}

// 4. Zustand storeì˜ addElementê°€ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  íˆìŠ¤í† ë¦¬ì— ì €ì¥
// íŒŒì¼: src/processes/editor-store.ts
addElement: (element) => {
  set((state) => ({
    canvas: {
      ...state.canvas,
      elements: [...state.canvas.elements, element],
      selectedElementIds: [element.id], // ìƒˆ ì—˜ë¦¬ë¨¼íŠ¸ ìë™ ì„ íƒ
    },
  }));
  get().saveToHistory(); // Undo/Redoë¥¼ ìœ„í•´ íˆìŠ¤í† ë¦¬ ì €ì¥
},
```

### ğŸ¯ ë°ì´í„° í”Œë¡œìš°
```
ì‚¬ìš©ì í´ë¦­ â†’ handleAddElement â†’ createElement â†’ addElement (Zustand) â†’ Canvas ë¦¬ë Œë”ë§ â†’ ìƒˆ ì—˜ë¦¬ë¨¼íŠ¸ í‘œì‹œ
```

---

## 2. ì»´í¬ë„ŒíŠ¸ ìº”ë²„ìŠ¤ ë Œë”ë§ ì‹œìŠ¤í…œ

### ğŸ“ í•µì‹¬ íŒŒì¼
- `src/widgets/canvas.tsx` - ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆ
- `src/features/draggable-element.tsx` - ë“œë˜ê·¸ ê°€ëŠ¥í•œ ë˜í¼
- `src/entities/*-element.tsx` - ê° ì—˜ë¦¬ë¨¼íŠ¸ ì»´í¬ë„ŒíŠ¸

### ğŸ”„ ë Œë”ë§ ê³¼ì • (ì‹¤ì œ ì½”ë“œ ê¸°ì¤€)

ì‹¤ì œ ë Œë”ë§ì€ `src/features/server-driven-ui/hybrid-renderer.tsx` íŒŒì¼ì˜ `HybridRenderer` ì»´í¬ë„ŒíŠ¸ê°€ ë‹´ë‹¹í•˜ë©°, ì¬ê·€ì ì¸ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

1.  **`HybridRenderer` (ì§„ì…ì )**: ìµœìƒìœ„ ì—˜ë¦¬ë¨¼íŠ¸ë“¤ì„ ì°¾ì•„ ê°ê° `HybridElement` ì»´í¬ë„ŒíŠ¸ë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.
2.  **`HybridElement` (ì¬ê·€ ë Œë”ë§)**: ê° ì—˜ë¦¬ë¨¼íŠ¸ì˜ `layoutMode` (absolute, flex ë“±)ì— ë§ëŠ” ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ê³ , ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ê°€ ìˆë‹¤ë©´ `HybridElement` ìì‹ ì„ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ íŠ¸ë¦¬ êµ¬ì¡°ë¥¼ ê·¸ë ¤ë‚˜ê°‘ë‹ˆë‹¤.
3.  **`renderElementContent` (ì½˜í…ì¸  ë Œë”ë§)**: `type`ì— ë”°ë¼ `Text`, `Button` ë“± ì‹¤ì œ ë‚´ìš©ì„ ë‹´ì€ UI ì»´í¬ë„ŒíŠ¸ë¥¼ `switch` êµ¬ë¬¸ì„ í†µí•´ ë Œë”ë§í•©ë‹ˆë‹¤.

ì•„ë˜ëŠ” í•´ë‹¹ íŒŒì¼ì˜ í•µì‹¬ ë¡œì§ì„ ê°„ì¶”ë¦° ì‹¤ì œ ì½”ë“œì…ë‹ˆë‹¤.

```typescript
// íŒŒì¼: src/features/server-driven-ui/hybrid-renderer.tsx

// 1. ì§„ì…ì  ì»´í¬ë„ŒíŠ¸
export function HybridRenderer({ elements, ... }: HybridRendererProps) {
  // ìµœìƒìœ„ ìš”ì†Œë“¤ì„ ì°¾ì•„ ë Œë”ë§ ì‹œì‘
  const topLevelElements = elements.filter(/* ... */);

  return (
    <div style={/* ... */}>
      {topLevelElements.map((element) => (
        <HybridElement 
          key={element.id} 
          element={element} 
          elementMap={elementMap}
        />
      ))}
    </div>
  );
}

// 2. ì¬ê·€ì ìœ¼ë¡œ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë Œë”ë§í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
function HybridElement({ element, elementMap }: HybridElementProps) {
  // ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ë“¤ì„ ê°€ì ¸ì˜´
  const childElements = element.children.map(/* ... */);
  
  // ë ˆì´ì•„ì›ƒ ëª¨ë“œì— ë”°ë¼ ìŠ¤íƒ€ì¼ ê³„ì‚°
  const layoutStyle = getLayoutStyle(); // absolute, flex, grid ë“± ì²˜ë¦¬

  // ì»¨í…Œì´ë„ˆì¼ ê²½ìš°, ìì‹ë“¤ì„ ì¬ê·€ì ìœ¼ë¡œ ë Œë”ë§
  if (element.type === "container") {
    return (
      <div style={layoutStyle}>
        {childElements.map(child => (
          <HybridElement /* ... */ />
        ))}
      </div>
    );
  }

  // ë‹¤ë¥¸ ì—˜ë¦¬ë¨¼íŠ¸ë“¤ì€ ì½˜í…ì¸  ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
  return (
    <div style={layoutStyle}>
      {renderElementContent(element)}
    </div>
  );
}

// 3. íƒ€ì…ì— ë”°ë¼ ì‹¤ì œ UIë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜ (MD íŒŒì¼ì˜ renderElementì™€ ê°€ì¥ ìœ ì‚¬)
function renderElementContent(element: HybridRenderElement) {
  switch (element.type) {
    case "text":
      return (
        <div style={/* ... */}>
          {element.props.content}
        </div>
      );

    case "image":
      return <Image src={element.props.src} /* ... */ />;

    case "button":
      return (
        <Button style={/* ... */}>
          {element.props.text}
        </Button>
      );
    
    // ... ê¸°íƒ€ ì—˜ë¦¬ë¨¼íŠ¸ íƒ€ì…ë“¤
    
    default:
      return <div>Unknown element: {element.type}</div>;
  }
}
```

### ğŸ¨ ìœ„ì¹˜ ë° ìŠ¤íƒ€ì¼ ì ìš©
ê° ì—˜ë¦¬ë¨¼íŠ¸ëŠ” ì ˆëŒ€ ìœ„ì¹˜(`position: absolute`)ë¡œ ë°°ì¹˜ë˜ë©°, ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ë™ì  ì†ì„±ì´ ì ìš©ë©ë‹ˆë‹¤:

```typescript
// TextElement ì˜ˆì‹œ
<div
  className="absolute cursor-pointer select-none"
  style={{
    left: element.x,          // ë™ì  X ìœ„ì¹˜
    top: element.y,           // ë™ì  Y ìœ„ì¹˜
    width: actualWidth,       // ê³„ì‚°ëœ ì‹¤ì œ ë„ˆë¹„
    height: actualHeight,     // ê³„ì‚°ëœ ì‹¤ì œ ë†’ì´
    zIndex: element.zIndex,   // Z-ì¸ë±ìŠ¤
    fontSize: element.fontSize,
    color: element.color,
    // ... ê¸°íƒ€ ë™ì  ìŠ¤íƒ€ì¼
  }}
>
```

---

## 3. ì†ì„± íŒ¨ë„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì‹œìŠ¤í…œ

### ğŸ“ í•µì‹¬ íŒŒì¼
- `src/widgets/property-panel.tsx` - ì†ì„± íŒ¨ë„ ë©”ì¸
- `src/processes/editor-store.ts` - ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸ ë¡œì§

### ğŸ”„ ë™ì  ì†ì„± ë Œë”ë§ (ì‹¤ì œ ì½”ë“œ ê¸°ì¤€)

`property-panel.tsx` íŒŒì¼ì€ ì„ íƒëœ ì—˜ë¦¬ë¨¼íŠ¸ì˜ `type`ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë‹¤ë¥¸ ì†ì„± í¸ì§‘ UIë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.

1.  **`PropertyPanel` ì»´í¬ë„ŒíŠ¸**: Zustand ìŠ¤í† ì–´ì—ì„œ í˜„ì¬ ì„ íƒëœ ì—˜ë¦¬ë¨¼íŠ¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
2.  **`renderSpecificProperties` í•¨ìˆ˜**: `switch` êµ¬ë¬¸ì„ ì‚¬ìš©í•´ ì—˜ë¦¬ë¨¼íŠ¸ íƒ€ì…ì— ë§ëŠ” ë Œë”ë§ í•¨ìˆ˜(ì˜ˆ: `renderTextProperties`)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
3.  **íƒ€ì…ë³„ ë Œë”ë§ í•¨ìˆ˜**: ê° íƒ€ì…ì— ë§ëŠ” UI ì»¨íŠ¸ë¡¤(Input, Select ë“±)ì„ ë Œë”ë§í•˜ê³ , `onChange` ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ìŠ¤í† ì–´ì˜ `updateElement` ì•¡ì…˜ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.

```typescript
// íŒŒì¼: src/widgets/property-panel.tsx

export default function PropertyPanel() {
  const { canvas, updateElement } = useEditorStore();

  // 1. ë‹¨ì¼ ì„ íƒëœ ì—˜ë¦¬ë¨¼íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const selectedElement = canvas.elements.find(
    (el) => el.id === canvas.selectedElementIds[0]
  );

  if (!selectedElement) {
    return <p>ìš”ì†Œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>;
  }

  // 3. `updateElement`ë¥¼ í˜¸ì¶œí•˜ëŠ” ì¼ë°˜ í•¸ë“¤ëŸ¬
  const handlePropertyChange = (property: string, value: any) => {
    updateElement(selectedElement.id, { [property]: value });
  };

  // 2. íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ UIë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
  const renderSpecificProperties = () => {
    switch (selectedElement.type) {
      case "text":
        return renderTextProperties(selectedElement);
      case "button":
        return renderButtonProperties(selectedElement);
      // ... ë‹¤ë¥¸ íƒ€ì…ë“¤
      default:
        return null;
    }
  };

  // 3. í…ìŠ¤íŠ¸ ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì†ì„± UIë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
  const renderTextProperties = (element: TextElement) => (
    <div className="space-y-4">
      <div>
        <Label htmlFor="content">ë‚´ìš©</Label>
        <Textarea
          id="content"
          value={element.content}
          onChange={(e) => handlePropertyChange("content", e.target.value)}
        />
      </div>
      <div className="grid grid-cols-2 gap-2">
        <div>
          <Label htmlFor="fontSize">ê¸€ì í¬ê¸°</Label>
          <Input
            id="fontSize"
            type="number"
            value={element.fontSize}
            onChange={(e) => handlePropertyChange("fontSize", parseInt(e.target.value))}
          />
        </div>
        <div>
          <Label htmlFor="color">ìƒ‰ìƒ</Label>
          <Input
            id="color"
            type="color"
            value={element.color}
            onChange={(e) => handlePropertyChange("color", e.target.value)}
          />
        </div>
      </div>
    </div>
  );

  return (
    <Card className="p-4">
      <h3 className="font-medium">ì†ì„±</h3>
      {renderSpecificProperties()}
      {/* ... ê³µí†µ ì†ì„± UI (ìœ„ì¹˜, í¬ê¸° ë“±) */}
    </Card>
  );
}
```

### ğŸ›ï¸ ìŠ¤ë§ˆíŠ¸ íƒ€ì… ë³€í™˜ ì‹œìŠ¤í…œ (ì‹¤ì œ ì½”ë“œ)

MD íŒŒì¼ì˜ ì˜ˆì‹œì™€ ê±°ì˜ ë™ì¼í•œ `createAutoTypeHandler` í•¨ìˆ˜ê°€ ì‹¤ì œ ì½”ë“œì—ì„œë„ ì‚¬ìš©ë˜ì–´, `Input`ì˜ `type`ì— ë”°ë¼ ë¬¸ìì—´ ê°’ì„ ìˆ«ìë‚˜ "auto" í‚¤ì›Œë“œë¡œ ìë™ ë³€í™˜í•´ì¤ë‹ˆë‹¤.

```typescript
// íŒŒì¼: src/widgets/property-panel.tsx

// íƒ€ì… ìë™ ì¶”ë¡ ì„ ìœ„í•œ í•¸ë“¤ëŸ¬ í•¨ìˆ˜
const createAutoTypeHandler = (property: string, elementId: string) => {
  return (e: React.ChangeEvent<HTMLInputElement>) => {
    const input = e.target;
    const value = input.value;
    const inputType = input.type;

    let processedValue: string | number = value;

    if (inputType === "number") {
      processedValue = value === "" ? 0 : parseFloat(value);
      if (isNaN(processedValue)) processedValue = 0;
    } else if (inputType === "text") {
      if (value === "auto") {
        processedValue = "auto";
      } else {
        const numValue = parseFloat(value);
        processedValue = isNaN(numValue) ? value : numValue;
      }
    }

    updateElement(elementId, { [property]: processedValue });
  };
};
```

---

## 4. ê·¸ë¦¬ë“œ ìŠ¤ëƒ… ì‹œìŠ¤í…œ

### ğŸ“ í•µì‹¬ íŒŒì¼
- `src/processes/editor-store.ts` - ê·¸ë¦¬ë“œ ì„¤ì • ë° ìŠ¤ëƒ… ë¡œì§
- `src/widgets/canvas.tsx` - ê·¸ë¦¬ë“œ ì‹œê°í™”

### ğŸ”„ ê·¸ë¦¬ë“œ ìŠ¤ëƒ… ì•Œê³ ë¦¬ì¦˜ (ì‹¤ì œ ì½”ë“œ)

ê·¸ë¦¬ë“œ ìŠ¤ëƒ… ë¡œì§ì€ `src/processes/editor-store.ts`ì˜ `snapToGrid` í•¨ìˆ˜ì— êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©°, MD ë¬¸ì„œì˜ ì˜ˆì‹œì™€ ê±°ì˜ ë™ì¼í•©ë‹ˆë‹¤.

```typescript
// íŒŒì¼: src/processes/editor-store.ts

snapToGrid: (x: number, y: number) => {
  const { grid } = get();
  if (!grid.snapToGrid) return { x, y };

  const cellSize = grid.cellSize;

  // ìš”ì†Œì˜ ì™¼ìª½ ìœ„ ëª¨ì„œë¦¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë¦¬ë“œì— ìŠ¤ëƒ…
  return {
    x: Math.round(x / cellSize) * cellSize,
    y: Math.round(y / cellSize) * cellSize,
  };
},
```

### ğŸ¨ ê·¸ë¦¬ë“œ ì‹œê°í™” (ì‹¤ì œ ì½”ë“œ)

ê·¸ë¦¬ë“œ ì‹œê°í™”ëŠ” `src/widgets/canvas.tsx`ì—ì„œ `GridOverlay` ì»´í¬ë„ŒíŠ¸ë¥¼ í˜¸ì¶œí•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì´ ì»´í¬ë„ŒíŠ¸ëŠ” ë“œë˜ê·¸ ì¤‘ì´ê³ , ê·¸ë¦¬ë“œ í‘œì‹œ ì˜µì…˜ì´ ì¼œì ¸ ìˆì„ ë•Œë§Œ ë Œë”ë§ë©ë‹ˆë‹¤.

```typescript
// 1. Canvas ì»´í¬ë„ŒíŠ¸ì—ì„œ GridOverlay í˜¸ì¶œ
// íŒŒì¼: src/widgets/canvas.tsx

<GridOverlay
  grid={grid}
  canvasWidth={canvas.width}
  canvasHeight={canvas.height}
  isDragging={isDragging}
/>

// 2. GridOverlay ì»´í¬ë„ŒíŠ¸ì˜ ì‹¤ì œ êµ¬í˜„
// íŒŒì¼: src/components/ui/grid-overlay.tsx

export default function GridOverlay({ grid, isDragging }: GridOverlayProps) {
  // ê·¸ë¦¬ë“œê°€ ì¼œì ¸ìˆê³  ë“œë˜ê·¸ ì¤‘ì¼ ë•Œë§Œ í‘œì‹œ
  if (!grid.showGrid || !isDragging) return null;

  const { cellSize } = grid;

  // ê·¸ë¦¬ë“œ ë¼ì¸ì„ ê·¸ë¦¬ëŠ” SVG íŒ¨í„´ ìƒì„±
  const gridPattern = `
    <defs>
      <pattern id="grid" width="${cellSize}" height="${cellSize}" patternUnits="userSpaceOnUse">
        <path d="M ${cellSize} 0 L 0 0 0 ${cellSize}" fill="none" stroke="#e5e7eb" stroke-width="1"/>
      </pattern>
    </defs>
    <rect width="100%" height="100%" fill="url(#grid)" />
  `;

  return (
    <div className="absolute inset-0 pointer-events-none z-0">
      <svg
        width="100%"
        height="100%"
        dangerouslySetInnerHTML={{ __html: gridPattern }}
      />
    </div>
  );
}
```

---

## 5. ì¤Œ ì¸/ì•„ì›ƒ ì‹œìŠ¤í…œ

### ğŸ“ í•µì‹¬ íŒŒì¼
- `src/widgets/canvas.tsx` - ì¤Œ UI ë° ë¡œì§
- `src/processes/editor-store.ts` - ì¤Œ ìƒíƒœ ê´€ë¦¬

### ğŸ”„ ì¤Œ êµ¬í˜„ ë°©ì‹ (ì‹¤ì œ ì½”ë“œ ê¸°ì¤€)

ì¤Œ ê¸°ëŠ¥ì€ `editor-store`ì˜ ìƒíƒœ, `canvas.tsx`ì˜ UI ë° ì´ë²¤íŠ¸ ì²˜ë¦¬, `draggable-element.tsx`ì˜ ë“œë˜ê·¸ ë³´ì • ë¡œì§ì˜ ì¡°í•©ìœ¼ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤.

```typescript
// 1. Zustand ìŠ¤í† ì–´ì—ì„œ ì¤Œ ìƒíƒœ ê´€ë¦¬
// íŒŒì¼: src/processes/editor-store.ts
export const useEditorStore = create<EditorStore>((set) => ({
  canvasZoom: 1,
  setCanvasZoom: (zoom) => {
    set({ canvasZoom: Math.max(0.1, Math.min(3, zoom)) });
  },
  // ...
}));

// 2. ìº”ë²„ìŠ¤ì—ì„œ CSS Transformê³¼ íœ  ì´ë²¤íŠ¸ë¡œ ì¤Œ UI êµ¬í˜„
// íŒŒì¼: src/widgets/canvas.tsx
export default function Canvas() {
  const { canvasZoom, setCanvasZoom } = useEditorStore();
  const canvasRef = useRef<HTMLDivElement>(null);

  // Ctrl/Cmd + íœ  ì´ë²¤íŠ¸ë¡œ ì¤Œ ì¡°ì ˆ
  const handleWheel = useCallback((e: WheelEvent) => {
    if (!e.ctrlKey && !e.metaKey) return;
    e.preventDefault();
    const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
    const newZoom = Math.max(0.1, Math.min(3, canvasZoom * zoomFactor));
    setCanvasZoom(newZoom);
  }, [canvasZoom, setCanvasZoom]);

  // ... useEffectì—ì„œ wheel ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ...

  return (
    <div ref={canvasRef} /* ... */>
      <div style={{
          width: canvas.width,
          height: canvas.height,
          transform: `scale(${canvasZoom})`, // ì¤Œ ë ˆë²¨ ì ìš©
          transformOrigin: "top left",
        }}>
        {/* ... ì—˜ë¦¬ë¨¼íŠ¸ ë Œë”ë§ ... */}
      </div>
    </div>
  );
}

// 3. ë“œë˜ê·¸ ì‹œ ì¤Œ ë ˆë²¨ì„ ê³ ë ¤í•˜ì—¬ ì´ë™ ê±°ë¦¬ ë³´ì •
// íŒŒì¼: src/features/draggable-element.tsx
export default function DraggableElement({ element, children }: DraggableElementProps) {
  const { canvasZoom } = useEditorStore();

  const { attributes, listeners, setNodeRef, transform } = useDraggable({
    id: element.id,
  });

  // dnd-kitì˜ transform ê°’ì„ ì¤Œ ë ˆë²¨ë¡œ ë‚˜ëˆ„ì–´ ì‹¤ì œ ì´ë™ ê±°ë¦¬ë¥¼ ê³„ì‚°
  const style = transform
    ? {
        transform: `translate3d(${transform.x / canvasZoom}px, ${
          transform.y / canvasZoom
        }px, 0)`,
      }
    : undefined;

  return (
    <div ref={setNodeRef} style={style} {...listeners} {...attributes}>
      {children}
    </div>
  );
}
```

---

## 6. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì‹œìŠ¤í…œ

### ğŸ“ í•µì‹¬ íŒŒì¼
- `src/features/drag-drop.tsx` - DnD ì»¨í…ìŠ¤íŠ¸ í”„ë¡œë°”ì´ë”
- `src/features/draggable-element.tsx` - ë“œë˜ê·¸ ê°€ëŠ¥í•œ ì—˜ë¦¬ë¨¼íŠ¸ ë˜í¼

### ğŸ”„ @dnd-kit ê¸°ë°˜ êµ¬í˜„ (ì‹¤ì œ ì½”ë“œ)

`@dnd-kit`ì˜ `DndContext`ë¥¼ ì„¤ì •í•˜ê³ , ë“œë˜ê·¸ ì‹œì‘/ì¢…ë£Œ ì´ë²¤íŠ¸ì— ëŒ€í•œ í•¸ë“¤ëŸ¬ë¥¼ ì •ì˜í•˜ì—¬ ì „ì²´ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë¡œì§ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

```typescript
// íŒŒì¼: src/features/drag-drop.tsx

export default function DragDropProvider({ children }: DragDropProviderProps) {
  const { moveElement, setDragging, snapToGrid, canvasZoom, grid, ... } = useEditorStore();

  // 1. ì„¼ì„œ ì„¤ì • (8px ì´ìƒ ì´ë™í•´ì•¼ ë“œë˜ê·¸ ì‹œì‘)
  const sensors = useSensors(
    useSensor(PointerSensor, {
      activationConstraint: {
        distance: 8,
      },
    })
  );

  // 2. ë“œë˜ê·¸ ì‹œì‘ ì‹œ ê·¸ë¦¬ë“œ í‘œì‹œ ë° ìƒíƒœ ì„¤ì •
  const handleDragStart = () => {
    setDragging(true);
    // ... (ê·¸ë¦¬ë“œ ìƒíƒœ ì €ì¥ ë° í‘œì‹œ ë¡œì§) ...
  };

  // 3. ë“œë˜ê·¸ ì¢…ë£Œ ì‹œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ë° ìƒíƒœ ë³µì›
  const handleDragEnd = (event: DragEndEvent) => {
    const { active, delta } = event;

    if (delta.x !== 0 || delta.y !== 0) {
      const element = canvas.elements.find((el) => el.id === active.id);
      if (element) {
        // ì¤Œ ë ˆë²¨ì— ë§ê²Œ ì´ë™ ê±°ë¦¬ ë³´ì •
        const scaledDeltaX = delta.x / canvasZoom;
        const scaledDeltaY = delta.y / canvasZoom;

        const newX = element.x + scaledDeltaX;
        const newY = element.y + scaledDeltaY;

        // ê·¸ë¦¬ë“œì— ìŠ¤ëƒ… ì ìš©
        const snappedPosition = snapToGrid(newX, newY);
        
        // Zustand ìŠ¤í† ì–´ì˜ ì—˜ë¦¬ë¨¼íŠ¸ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        moveElement(element.id, snappedPosition.x, snappedPosition.y);
      }
    }

    setDragging(false);
    // ... (ì›ë˜ ê·¸ë¦¬ë“œ ìƒíƒœë¡œ ë³µì›) ...
  };

  return (
    <DndContext
      sensors={sensors}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
    >
      {children}
    </DndContext>
  );
}
```

---

## 7. ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ (Zustand)

### ğŸ“ í•µì‹¬ íŒŒì¼
- `src/processes/editor-store.ts` - ë©”ì¸ ì—ë””í„° ìŠ¤í† ì–´

### ğŸ—ï¸ ìŠ¤í† ì–´ êµ¬ì¡° (ì‹¤ì œ ì½”ë“œ)

`EditorState` ì¸í„°í˜ì´ìŠ¤ëŠ” ìŠ¤í† ì–´ê°€ ê´€ë¦¬í•˜ëŠ” ëª¨ë“  ìƒíƒœì˜ íƒ€ì…ì„ ì •ì˜í•©ë‹ˆë‹¤. ì‹¤ì œ ìŠ¤í† ì–´ëŠ” ë” ë§ì€ UI ìƒíƒœì™€ í˜ì´ì§€ ê´€ë¦¬ ìƒíƒœë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

```typescript
// íŒŒì¼: src/shared/types/index.ts & src/processes/editor-store.ts

interface EditorState {
  // í˜ì´ì§€ ë° ì €ì¥ ìƒíƒœ
  currentPageId: string | null;
  currentPageTitle: string;
  isSaving: boolean;

  // ìº”ë²„ìŠ¤ ìƒíƒœ
  canvas: Canvas;
  
  // íˆìŠ¤í† ë¦¬ (Undo/Redoìš©)
  history: Canvas[];
  historyIndex: number;
  
  // UI ìƒíƒœ
  leftPanelVisible: boolean;
  rightPanelVisible: boolean;
  isDragging: boolean;
  isResizing: boolean;
  canvasZoom: number;
  
  // ê·¸ë¦¬ë“œ ì„¤ì •
  grid: GridConfig;
}

interface Canvas {
  elements: Element[];
  selectedElementIds: string[];
  width: number;
  height: number;
}
```

### ğŸ”„ ì£¼ìš” ì•¡ì…˜ë“¤ (ì‹¤ì œ ì½”ë“œ)

ì‹¤ì œ ì•¡ì…˜ í•¨ìˆ˜ë“¤ì€ `set`ê³¼ `get`ì„ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , í•„ìš”ì— ë”°ë¼ íˆìŠ¤í† ë¦¬ ì €ì¥ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.

```typescript
// íŒŒì¼: src/processes/editor-store.ts

export const useEditorStore = create<EditorStore>((set, get) => ({
  // ... ì´ˆê¸° ìƒíƒœ ...

  // ì—˜ë¦¬ë¨¼íŠ¸ ì¶”ê°€
  addElement: (element) => {
    set((state) => ({
      canvas: {
        ...state.canvas,
        elements: [...state.canvas.elements, element],
        selectedElementIds: [element.id], // ìƒˆ ì—˜ë¦¬ë¨¼íŠ¸ ìë™ ì„ íƒ
      },
    }));
    get().saveToHistory(); // íˆìŠ¤í† ë¦¬ ì €ì¥
  },

  // ì—˜ë¦¬ë¨¼íŠ¸ ì†ì„± ì—…ë°ì´íŠ¸
  updateElement: (id, updates) => {
    set((state) => ({
      canvas: {
        ...state.canvas,
        elements: state.canvas.elements.map((element) =>
          element.id === id ? ({ ...element, ...updates } as Element) : element
        ),
      },
    }));
    // ì£¼: ì†ì„± ë³€ê²½ì€ íˆìŠ¤í† ë¦¬ì— ì €ì¥í•˜ì§€ ì•Šì•„ ì¦‰ê°ì ì¸ ë°˜ì‘ì„±ì„ ë³´ì¥
  },

  // ë‹¤ì¤‘ ì„ íƒ í† ê¸€
  toggleSelection: (id) => {
    set((state) => {
      const isSelected = state.canvas.selectedElementIds.includes(id);
      const newSelection = isSelected
        ? state.canvas.selectedElementIds.filter((selectedId) => selectedId !== id)
        : [...state.canvas.selectedElementIds, id];
      
      return {
        canvas: { ...state.canvas, selectedElementIds: newSelection },
      };
    });
  },

  // ì„ íƒëœ ìš”ì†Œë“¤ ì‚­ì œ
  deleteSelectedElements: () => {
    set((state) => ({
      canvas: {
        ...state.canvas,
        elements: state.canvas.elements.filter(
          (element) => !state.canvas.selectedElementIds.includes(element.id)
        ),
        selectedElementIds: [],
      },
    }));
    get().saveToHistory();
  },
}));
```

---

## 8. ìŠ¤íƒ€ì¼ë§ ì‹œìŠ¤í…œ ë¶„ì„

### ğŸ¨ í˜„ì¬ ìŠ¤íƒ€ì¼ë§ ë°©ì‹: **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•**

ì´ í”„ë¡œì íŠ¸ëŠ” **Tailwind CSS + ì¸ë¼ì¸ CSS ìŠ¤íƒ€ì¼**ì˜ í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

#### **ì •ì  ìŠ¤íƒ€ì¼ë§**: Tailwind CSS
```typescript
// ë ˆì´ì•„ì›ƒ, ìƒíƒœ í‘œì‹œ ë“± ê³ ì •ì ì¸ ìŠ¤íƒ€ì¼
<div className={cn(
  "absolute cursor-pointer select-none",
  isSelected ? "ring-2 ring-blue-500 ring-offset-2" : ""
)} />
```

#### **ë™ì  ìŠ¤íƒ€ì¼ë§**: ì¸ë¼ì¸ CSS
```typescript
// ì‚¬ìš©ìê°€ ì¡°ì • ê°€ëŠ¥í•œ ë™ì  ì†ì„±ë“¤
style={{
  left: element.x,              // ìœ„ì¹˜
  top: element.y,
  width: actualWidth,           // í¬ê¸°
  height: actualHeight,
  fontSize: element.fontSize,   // í…ìŠ¤íŠ¸ ì†ì„±
  color: element.color,
  backgroundColor: element.backgroundColor,
  // ... ëª¨ë“  ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥í•œ ì†ì„±
}}
```

---

## 9. ì›¹ ë¹Œë” íŠ¹ì„±ìƒ ë™ì  ìŠ¤íƒ€ì¼ë§ ìµœì í™” ë¶„ì„

### ğŸ¯ **ì™œ í˜„ì¬ ë°©ì‹ì´ ì ì ˆí•œê°€?**

#### âœ… **ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ì˜ ì¥ì  (ì›¹ ë¹Œë” íŠ¹ì„±ìƒ)**
1. **ì‹¤ì‹œê°„ ë°˜ì˜**: ì†ì„± ë³€ê²½ì´ ì¦‰ì‹œ DOMì— ë°˜ì˜
2. **ë™ì  ê°’ ì²˜ë¦¬**: ì‚¬ìš©ì ì…ë ¥ê°’ì„ ì§ì ‘ CSSë¡œ ë³€í™˜ ê°€ëŠ¥
3. **íƒ€ì… ì•ˆì „ì„±**: TypeScriptë¡œ ìŠ¤íƒ€ì¼ ê°’ ê²€ì¦ ê°€ëŠ¥
4. **ìŠ¤ì½”í”„ ê²©ë¦¬**: ê° ì—˜ë¦¬ë¨¼íŠ¸ì˜ ìŠ¤íƒ€ì¼ì´ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬

#### âœ… **Tailwind CSSì˜ ì¥ì  (ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼)**
1. **ì¼ê´€ëœ ë””ìì¸ ì‹œìŠ¤í…œ**: ìƒ‰ìƒ, ê°„ê²©, íƒ€ì´í¬ê·¸ë˜í”¼ í†µì¼
2. **ê°œë°œ ìƒì‚°ì„±**: ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë¡œ ë¹ ë¥¸ ìŠ¤íƒ€ì¼ë§
3. **ë²ˆë“¤ ìµœì í™”**: ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í´ë˜ìŠ¤ ìë™ ì œê±°
4. **ë°˜ì‘í˜• ë””ìì¸**: ì‰¬ìš´ ë°˜ì‘í˜• ì²˜ë¦¬

### ğŸš€ **ì„±ëŠ¥ ìµœì í™” ì¸¡ë©´**

#### **ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ vs CSS-in-JS vs ë™ì  í´ë˜ìŠ¤**

| ë°©ì‹ | ë Œë”ë§ ì†ë„ | ë©”ëª¨ë¦¬ ì‚¬ìš© | ê°œë°œ ë³µì¡ë„ | ì›¹ ë¹Œë” ì í•©ì„± |
|------|------------|------------|------------|--------------|
| ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| CSS-in-JS | â­â­ | â­â­ | â­â­â­ | â­â­ |
| ë™ì  í´ë˜ìŠ¤ | â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­ |

#### **í˜„ì¬ ë°©ì‹ì˜ ì„±ëŠ¥ ì¥ì **
- CSS íŒŒì‹±/ë§¤ì¹­ ë‹¨ê³„ ìƒëµ
- ìŠ¤íƒ€ì¼ ê³„ì‚°ì´ ì§ì ‘ì 
- ë¦¬í”Œë¡œìš°/ë¦¬í˜ì¸íŠ¸ ìµœì†Œí™”

---

## 10. ì„œë²„ ì €ì¥ ìŠ¤íƒ€ì¼ë§ ë°ì´í„° ì²˜ë¦¬ ë°©ì•ˆ

### ğŸ—ï¸ **ê¶Œì¥ ì•„í‚¤í…ì²˜: JSON + CSS ë³€ìˆ˜ í•˜ì´ë¸Œë¦¬ë“œ**

#### **Phase 1: í˜„ì¬ êµ¬ì¡° ìœ ì§€ (JSON ì €ì¥)**
```json
{
  "elements": [
    {
      "id": "text-1",
      "type": "text",
      "x": 100,
      "y": 200,
      "width": 300,
      "height": "auto",
      "content": "Hello World",
      "fontSize": 24,
      "color": "#333333",
      "fontFamily": "Inter",
      "textAlign": "center"
    }
  ]
}
```

#### **Phase 2: CSS ë³€ìˆ˜ ìµœì í™” (í–¥í›„ ê³ ë ¤)**
```json
{
  "cssVariables": {
    "--primary-color": "#3b82f6",
    "--text-lg": "18px",
    "--spacing-md": "16px"
  },
  "elements": [
    {
      "id": "text-1",
      "styles": {
        "color": "var(--primary-color)",
        "fontSize": "var(--text-lg)"
      }
    }
  ]
}
```

### ğŸ¯ **ì„±ëŠ¥ ìµœì í™” ì „ëµ**

#### **1. ì²­í¬ ë‹¨ìœ„ ë¡œë”©**
```typescript
// í° í”„ë¡œì íŠ¸ì˜ ê²½ìš° ì„¹ì…˜ë³„ ë¡œë”©
interface ProjectChunk {
  id: string;
  elements: Element[];
  viewport: { x: number, y: number, width: number, height: number };
}

// í˜„ì¬ ë·°í¬íŠ¸ ì˜ì—­ì˜ ì—˜ë¦¬ë¨¼íŠ¸ë§Œ ë¡œë”©
const loadVisibleElements = async (viewport: Viewport) => {
  const chunks = await api.getProjectChunks(projectId, viewport);
  return chunks.flatMap(chunk => chunk.elements);
};
```

#### **2. ì¦ë¶„ ì—…ë°ì´íŠ¸**
```typescript
// ì „ì²´ í”„ë¡œì íŠ¸ ë‹¤ì‹œ ì €ì¥í•˜ì§€ ì•Šê³  ë³€ê²½ëœ ì—˜ë¦¬ë¨¼íŠ¸ë§Œ ì—…ë°ì´íŠ¸
interface ElementUpdate {
  id: string;
  changes: Partial<Element>;
  timestamp: number;
}

const saveElementChanges = debounce(async (updates: ElementUpdate[]) => {
  await api.updateElements(projectId, updates);
}, 1000);
```

#### **3. ìŠ¤íƒ€ì¼ ìºì‹±**
```typescript
// ìì£¼ ì‚¬ìš©ë˜ëŠ” ìŠ¤íƒ€ì¼ ì¡°í•©ì„ ìºì‹œ
interface StylePreset {
  id: string;
  name: string;
  styles: Partial<Element>;
}

const applyStylePreset = (elementId: string, presetId: string) => {
  const preset = styleCache.get(presetId);
  if (preset) {
    updateElement(elementId, preset.styles);
  }
};
```

### ğŸ”„ **ë°ì´í„° ë™ê¸°í™” ì „ëµ**

#### **ì‹¤ì‹œê°„ í˜‘ì—…ì„ ìœ„í•œ OT (Operational Transformation)**
```typescript
interface Operation {
  type: 'update' | 'create' | 'delete' | 'move';
  elementId: string;
  changes: any;
  userId: string;
  timestamp: number;
}

// ì¶©ëŒ í•´ê²° ì•Œê³ ë¦¬ì¦˜
const resolveConflicts = (localOps: Operation[], remoteOps: Operation[]) => {
  // Last-write-wins ë˜ëŠ” ì •êµí•œ OT ì•Œê³ ë¦¬ì¦˜ ì ìš©
  return mergeOperations(localOps, remoteOps);
};
```

---

## 11. ìµœì¢… ê¶Œì¥ì‚¬í•­

### ğŸ¯ **í˜„ì¬ ìŠ¤íƒ€ì¼ë§ ë°©ì‹ ìœ ì§€ ì´ìœ **

1. **ì›¹ ë¹Œë” íŠ¹ì„±ìƒ ìµœì **: ì‚¬ìš©ì ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ì£¼ìš” ê¸°ëŠ¥
2. **ê°œë°œ ìƒì‚°ì„±**: ë³µì¡í•œ CSS-in-JS ì„¤ì • ë¶ˆí•„ìš”
3. **ì„±ëŠ¥**: ì§ì ‘ì ì¸ DOM ìŠ¤íƒ€ì¼ ì¡°ì‘ìœ¼ë¡œ ë¹ ë¥¸ ë Œë”ë§
4. **ìœ ì§€ë³´ìˆ˜ì„±**: ëª…í™•í•œ ë°ì´í„° â†’ ìŠ¤íƒ€ì¼ ë§¤í•‘

### ğŸš€ **ì„±ëŠ¥ ê°œì„  ìš°ì„ ìˆœìœ„**

#### **High Priority**
1. **React.memo** ì ìš©ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
2. **useCallback/useMemo** í™œìš©í•œ í•¸ë“¤ëŸ¬ ìµœì í™”
3. **Virtual Scrolling** ì ìš© (ì—˜ë¦¬ë¨¼íŠ¸ 50ê°œ ì´ìƒ ì‹œ)

#### **Medium Priority**  
1. **Web Workers**ë¥¼ í™œìš©í•œ ìŠ¤íƒ€ì¼ ê³„ì‚° ë¶„ë¦¬
2. **CSS Custom Properties**ë¡œ í…Œë§ˆ ì‹œìŠ¤í…œ êµ¬ì¶•
3. **IndexedDB** í™œìš©í•œ ë¡œì»¬ ìºì‹±

#### **Low Priority**
1. CSS-in-JS ë§ˆì´ê·¸ë ˆì´ì…˜ (í•„ìš”ì‹œì—ë§Œ)
2. SCSS ì „í™˜ (ë³µì¡ë„ ì¦ê°€ ëŒ€ë¹„ ì´ì  ë¶€ì¡±)

### ğŸ’¡ **ê²°ë¡ **

í˜„ì¬ì˜ **Tailwind CSS + ì¸ë¼ì¸ ìŠ¤íƒ€ì¼** í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ì€ ì›¹ ë¹Œë”ì˜ ìš”êµ¬ì‚¬í•­ì— ë§¤ìš° ì í•©í•©ë‹ˆë‹¤. 

**í•µì‹¬ ì´ìœ :**
- âš¡ **ì¦‰ì‹œì„±**: ì‚¬ìš©ì ì…ë ¥ì´ ë°”ë¡œ í™”ë©´ì— ë°˜ì˜
- ğŸ¯ **ì •í™•ì„±**: TypeScript íƒ€ì… ì²´í¬ë¡œ ì•ˆì „í•œ ìŠ¤íƒ€ì¼ ì ìš©  
- ğŸ”§ **ìœ ì—°ì„±**: ëª¨ë“  CSS ì†ì„±ì„ ë™ì ìœ¼ë¡œ ì œì–´ ê°€ëŠ¥
- ğŸ“ˆ **í™•ì¥ì„±**: ìƒˆë¡œìš´ ì—˜ë¦¬ë¨¼íŠ¸ íƒ€ì… ì¶”ê°€ê°€ ìš©ì´

ì„œë²„ ì €ì¥ ì‹œì—ë„ JSON í˜•íƒœì˜ ìŠ¤íƒ€ì¼ ë°ì´í„°ëŠ” ì§ê´€ì ì´ê³  ì²˜ë¦¬ê°€ ê°„ë‹¨í•˜ì—¬, ë³µì¡í•œ CSS ìƒì„± ë¡œì§ ì—†ì´ë„ ì•ˆì •ì ì¸ ì›¹ ë¹Œë”ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“š í•™ìŠµ í¬ì¸íŠ¸

ì´ í”„ë¡œì íŠ¸ì—ì„œ ì£¼ëª©í•  ë§Œí•œ í˜„ëŒ€ì  React ê°œë°œ íŒ¨í„´:

1. **Feature-Sliced Design**: í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜
2. **Zustand**: ê°„ë‹¨í•˜ë©´ì„œë„ ê°•ë ¥í•œ ìƒíƒœ ê´€ë¦¬
3. **@dnd-kit**: ì ‘ê·¼ì„±ì„ ê³ ë ¤í•œ ë“œë˜ê·¸ ì•¤ ë“œë¡­
4. **TypeScript**: íƒ€ì… ì•ˆì „ì„±ì„ í†µí•œ í’ˆì§ˆ ë³´ì¥
5. **Tailwind + ì¸ë¼ì¸ ìŠ¤íƒ€ì¼**: ì‹¤ìš©ì ì¸ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•

ì´ëŸ¬í•œ ê¸°ìˆ  ì„ íƒë“¤ì´ ì–´ë–»ê²Œ ì›¹ ë¹Œë”ë¼ëŠ” ë³µì¡í•œ ìš”êµ¬ì‚¬í•­ì„ íš¨ìœ¨ì ìœ¼ë¡œ í•´ê²°í•˜ëŠ”ì§€ê°€ ì´ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ í•™ìŠµ ê°€ì¹˜ì…ë‹ˆë‹¤.

---
---

# ì¶”ê°€ ë¶„ì„: ê³ ê¸‰ ì•„í‚¤í…ì²˜

ê¸°ì¡´ ë¶„ì„ ì™¸ì—, ì´ í”„ë¡œì íŠ¸ëŠ” ë”ìš± ì •êµí•œ ìµœì‹  ì›¹ ì•„í‚¤í…ì²˜ íŒ¨í„´ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## 12. ì„œë²„ ë“œë¦¬ë¸ UI (SDUI) ë Œë”ë§ ì•„í‚¤í…ì²˜

ì´ ì›¹ ë¹Œë”ëŠ” ì—ë””í„°ì™€ í”„ë¦¬ë·°(ì‹¤ì œ ê²°ê³¼ë¬¼)ë¥¼ ë¶„ë¦¬í•˜ì—¬ **ì„œë²„ ë“œë¦¬ë¸ UI (SDUI)** ë°©ì‹ìœ¼ë¡œ ìµœì¢… í˜ì´ì§€ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. ì´ëŠ” ì—ë””í„°ì˜ ë³µì¡í•œ ë¡œì§ê³¼ ì‹¤ì œ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í˜ì´ì§€ë¥¼ ì™„ì „íˆ ë¶„ë¦¬í•˜ì—¬ ì„±ëŠ¥ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” ì „ëµì…ë‹ˆë‹¤.

### ğŸ“ í•µì‹¬ íŒŒì¼
- **API ì—”ë“œí¬ì¸íŠ¸**: `src/app/api/render/[id]/route.ts`
- **í”„ë¦¬ë·° í˜ì´ì§€**: `src/app/preview/[id]/page.tsx`
- **í•˜ì´ë¸Œë¦¬ë“œ ë Œë”ëŸ¬**: `src/features/server-driven-ui/hybrid-renderer.tsx`
- **ë™ì  ì—˜ë¦¬ë¨¼íŠ¸**: `src/features/server-driven-ui/dynamic-element.tsx`

### ğŸ”„ ë°ì´í„° í”Œë¡œìš° (ì‹¤ì œ ì½”ë“œ ê¸°ì¤€)

```typescript
// 1. ì‚¬ìš©ìê°€ /preview/[id]ì— ì ‘ì†í•˜ë©´, í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ APIì— ë°ì´í„° ìš”ì²­
// íŒŒì¼: src/app/preview/[id]/page.tsx

useEffect(() => {
  if (!pageId) return;

  const fetchRenderData = async () => {
    try {
      setLoading(true);
      // 2. ì„œë²„ì˜ /api/render/[id] ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
      const response = await fetch(`/api/render/${pageId}`);
      if (!response.ok) {
        throw new Error("Failed to fetch page data");
      }
      const result = await response.json();
      setRenderData(result); // 5. ë°›ì€ JSONì„ stateì— ì €ì¥
    } catch (err) {
      setError(/* ... */);
    } finally {
      setLoading(false);
    }
  };

  fetchRenderData();
}, [pageId]);


// 3. API ì—”ë“œí¬ì¸íŠ¸ëŠ” DBì—ì„œ í˜ì´ì§€ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì—¬ JSONìœ¼ë¡œ ì‘ë‹µ
// íŒŒì¼: src/app/api/render/[id]/route.ts

export async function GET(request: NextRequest, { params }: RouteParams) {
  try {
    const { id } = params;
    // 4. Prismaë¥¼ ì´ìš©í•´ DBì—ì„œ í˜ì´ì§€ ì¡°íšŒ
    const page = await prisma.page.findUnique({
      where: { id },
    });

    if (!page || !page.content) { /* ... error handling ... */ }

    // content í•„ë“œ(JSON)ë¥¼ í¬í•¨í•œ ë Œë”ë§ ë°ì´í„° êµ¬ì„±
    const renderData = {
      pageId: page.id,
      ...(page.content as object), // title, canvas í¬í•¨
      metadata: { /* ... */ }
    };

    return NextResponse.json(renderData, { status: 200 });
  } catch (error) { /* ... */ }
}


// 6. í´ë¼ì´ì–¸íŠ¸ëŠ” stateì— ì €ì¥ëœ ë°ì´í„°ë¡œ HybridRendererë¥¼ ë Œë”ë§
// íŒŒì¼: src/app/preview/[id]/page.tsx

if (renderData) {
  return (
    <main>
      <HybridRenderer
        elements={renderData.canvas.elements}
        canvasWidth={renderData.canvas.width}
        canvasHeight={renderData.canvas.height}
      />
    </main>
  );
}
```

### ğŸ¯ ì•„í‚¤í…ì²˜ì˜ ì¥ì 
- **ë¶„ë¦¬ëœ ê´€ì‹¬ì‚¬**: ì—ë””í„°ì˜ ë³µì¡ì„±(DND, ì†ì„± íŒ¨ë„ ë“±)ì´ ìµœì¢… ê²°ê³¼ë¬¼ì— ì „í˜€ ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **ì„±ëŠ¥**: í”„ë¦¬ë·° í˜ì´ì§€ëŠ” ìˆœìˆ˜í•˜ê²Œ ë°ì´í„°(JSON)ë¥¼ ë°›ì•„ ë Œë”ë§ë§Œ í•˜ë¯€ë¡œ ë§¤ìš° ê°€ë³ê³  ë¹ ë¦…ë‹ˆë‹¤.
- **ìœ ì—°ì„±**: ì„œë²„ì—ì„œ ë³´ë‚´ì£¼ëŠ” JSON êµ¬ì¡°ë§Œ ë³€ê²½í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ìˆ˜ì • ì—†ì´ë„ UIë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë‹¤ì¤‘ í”Œë«í¼ ì§€ì›**: ë™ì¼í•œ JSON ë°ì´í„°ë¥¼ ì›¹, ëª¨ë°”ì¼ ì•± ë“± ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¬ì‚¬ìš©í•˜ì—¬ ì¼ê´€ëœ UIë¥¼ ë Œë”ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 13. í•˜ì´ë¸Œë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì‹œìŠ¤í…œ

ë‹¨ìˆœíˆ ì ˆëŒ€ ìœ„ì¹˜(absolute)ì—ë§Œ ì˜ì¡´í•˜ì§€ ì•Šê³ , ìµœì‹  ì›¹ í‘œì¤€ì¸ **Flexbox, Grid, Flow ë ˆì´ì•„ì›ƒ**ì„ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì •êµí•œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### ğŸ“ í•µì‹¬ íŒŒì¼
- **íƒ€ì… ì •ì˜**: `src/shared/types/index.ts` (`ContainerElement`, `LayoutMode` ë“±)
- **ìƒíƒœ ê´€ë¦¬**: `src/processes/editor-store.ts` (ì»¨í…Œì´ë„ˆ ìì‹ ë° ë ˆì´ì•„ì›ƒ ê´€ë¦¬ ì•¡ì…˜)
- **UI**: `src/widgets/property-panel.tsx` (ë ˆì´ì•„ì›ƒ ëª¨ë“œ ì„¤ì • UI)
- **ë Œë”ëŸ¬**: `src/features/server-driven-ui/hybrid-renderer.tsx` (ë ˆì´ì•„ì›ƒ ë¡œì§ ì‹¤ì œ êµ¬í˜„)

### ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°
1.  **`ContainerElement` í™•ì¥**:
    -   `layoutMode`: "absolute" | "flex" | "grid" | "flow" ì¤‘ í•˜ë‚˜ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
    -   `children`: ì»¨í…Œì´ë„ˆì— ì†í•œ ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ë“¤ì˜ ID ë°°ì—´. ì´ë¥¼ í†µí•´ í‰ë©´ì ì¸ ì—˜ë¦¬ë¨¼íŠ¸ ëª©ë¡ì—ì„œ ë¶€ëª¨-ìì‹ ê´€ê³„ì˜ íŠ¸ë¦¬ êµ¬ì¡°ë¥¼ í˜•ì„±í•©ë‹ˆë‹¤.
    -   `flex`, `grid`: ê° ë ˆì´ì•„ì›ƒ ëª¨ë“œì— ëŒ€í•œ ìƒì„¸ ì†ì„±(ì˜ˆ: `flexDirection`, `gridTemplateColumns`)ì„ ë‹´ëŠ” ê°ì²´.

2.  **ì—ë””í„° (Property Panel)**:
    -   ì‚¬ìš©ìê°€ ì»¨í…Œì´ë„ˆë¥¼ ì„ íƒí•˜ë©´, ì†ì„± íŒ¨ë„ì— 'ë ˆì´ì•„ì›ƒ ëª¨ë“œ'ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë“œë¡­ë‹¤ìš´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
    -   ì„ íƒëœ ëª¨ë“œì— ë”°ë¼ Flexbox ì„¤ì •(ë°©í–¥, ì •ë ¬ ë“±)ì´ë‚˜ Grid ì„¤ì •(ì»¬ëŸ¼, í–‰ ë“±)ì„ í•  ìˆ˜ ìˆëŠ” ì „ìš© UIê°€ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤.

3.  **ìƒíƒœ ê´€ë¦¬ (Zustand)**:
    -   `addChildToContainer`, `removeChildFromContainer`: ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ì»¨í…Œì´ë„ˆì— ë‹¤ë¥¸ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë„£ê±°ë‚˜ ëº„ ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤.
    -   `setContainerLayoutMode`, `updateContainerLayout`: ì†ì„± íŒ¨ë„ì—ì„œ ì‚¬ìš©ìê°€ ë ˆì´ì•„ì›ƒ ì„¤ì •ì„ ë³€ê²½í•  ë•Œ í˜¸ì¶œë˜ì–´ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

4.  **ë Œë”ë§ (HybridRenderer)**:
    -   ë Œë”ë§ ì‹œ, `children` ë°°ì—´ì„ ì´ìš©í•´ ì—˜ë¦¬ë¨¼íŠ¸ ëª©ë¡ì„ íŠ¸ë¦¬ êµ¬ì¡°ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    -   ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë Œë”ë§í•  ë•Œ `layoutMode`ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    -   `flex` ëª¨ë“œì´ë©´, ì»¨í…Œì´ë„ˆ divì— `display: flex`ì™€ ê´€ë ¨ ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ê³  ìì‹ë“¤ì„ ë Œë”ë§í•©ë‹ˆë‹¤.
    -   `grid` ëª¨ë“œì´ë©´, `display: grid`ì™€ ê´€ë ¨ ìŠ¤íƒ€ì¼ì„ ì ìš©í•©ë‹ˆë‹¤.
    -   `absolute` ëª¨ë“œì´ë©´, ê¸°ì¡´ ë°©ì‹ëŒ€ë¡œ ìì‹ë“¤ì„ ì ˆëŒ€ ìœ„ì¹˜ë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.

### âœ¨ ê¸°ëŒ€ íš¨ê³¼
- **ê³ ê¸‰ ë ˆì´ì•„ì›ƒ êµ¬í˜„**: ì ˆëŒ€ ìœ„ì¹˜ë§Œìœ¼ë¡œëŠ” ë§Œë“¤ê¸° ì–´ë ¤ìš´ ë³µì¡í•˜ê³  ë°˜ì‘í˜•ì¸ UI êµ¬ì¡°ë¥¼ ì‚¬ìš©ìê°€ ì§ì ‘ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ìƒì‚°ì„± í–¥ìƒ**: ìë™ ì •ë ¬, ê°„ê²© ì¡°ì ˆ ë“± ë ˆì´ì•„ì›ƒ ì‹œìŠ¤í…œì˜ ì´ì ì„ í™œìš©í•´ í˜ì´ì§€ë¥¼ ë” ë¹ ë¥´ê³  ì‰½ê²Œ ë””ìì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **í˜„ì‹¤ì ì¸ ì›¹ í˜ì´ì§€ ì œì‘**: ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê±°ì˜ ëª¨ë“  ë ˆì´ì•„ì›ƒ ê¸°ë²•ì„ ì›¹ ë¹Œë” ë‚´ì—ì„œ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

---

## 14. (ì¶”ë¡ ) ê³ ê¸‰ ê¸°ëŠ¥: ì„œë²„ë‹¨ ë ˆì´ì•„ì›ƒ ë¶„ì„ ë° ìµœì í™”

í”„ë¡œì íŠ¸ ë‚´ `enhanced-render`, `layout-analysis` APIì˜ ì¡´ì¬ëŠ” ë‹¨ìˆœí•œ SDUIë¥¼ ë„˜ì–´ì„  ê³ ê¸‰ ê¸°ëŠ¥ì„ ì•”ì‹œí•©ë‹ˆë‹¤.

- **`layout-analysis` API**: ì„œë²„ì—ì„œ í˜ì´ì§€ì˜ ë ˆì´ì•„ì›ƒ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ ë¬¸ì œì (ì˜ˆ: ìš”ì†Œ ê²¹ì¹¨, ì •ë ¬ ë¶ˆì¼ì¹˜)ì„ ì§„ë‹¨í•˜ê±°ë‚˜, ë” ë‚˜ì€ êµ¬ì¡°(ì˜ˆ: Flexbox ì‚¬ìš© ì œì•ˆ)ë¥¼ ì¶”ì²œí•˜ëŠ” ì—­í• ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `layout-optimizer.ts`ê°€ ì´ ë¡œì§ì„ ë‹´ë‹¹í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
- **`enhanced-render` API**: `layout-analysis`ì˜ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ìµœì í™”ëœ ë ˆì´ì•„ì›ƒ JSONì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ìê°€ ì—‰ì„±í•˜ê²Œ ë°°ì¹˜í•œ ìš”ì†Œë“¤ì„ ì„œë²„ê°€ ìë™ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë³´ì—¬ì£¼ëŠ” 'ìë™ ìµœì í™”' ë Œë”ë§ ëª¨ë“œë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ê¸°ëŠ¥ë“¤ì€ AIë¥¼ ê²°í•©í•˜ì—¬ ì‚¬ìš©ì ë””ìì¸ì„ ìë™ìœ¼ë¡œ ê°œì„ í•´ì£¼ëŠ” ì°¨ì„¸ëŒ€ ì›¹ ë¹Œë”ë¡œ ë°œì „í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì´ ë©ë‹ˆë‹¤.

---
---

# ì¶”ê°€ ë¶„ì„: ë°±ì—”ë“œ ë° ë°ì´í„° ê´€ë¦¬

ê¸°ì¡´ ë¶„ì„ì€ í”„ë¡ íŠ¸ì—”ë“œ ë Œë”ë§ê³¼ ìƒíƒœ ê´€ë¦¬ì— ì¤‘ì ì„ ë‘ì—ˆìŠµë‹ˆë‹¤. ì´ ì„¹ì…˜ì—ì„œëŠ” ì‚¬ìš©ìì˜ ì‘ì—…ì„ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°±ì—”ë“œ ì‹œìŠ¤í…œì„ ë¶„ì„í•©ë‹ˆë‹¤.

## 15. ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ (NextAuth.js)

ì´ í”„ë¡œì íŠ¸ëŠ” NextAuth.jsë¥¼ ì‚¬ìš©í•˜ì—¬ ê°•ë ¥í•˜ê³  ì•ˆì „í•œ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.

### ğŸ“ í•µì‹¬ íŒŒì¼
- **ì¸ì¦ ë¡œì§**: `src/app/api/auth/[...nextauth]/route.ts`
- **ë¼ìš°íŠ¸ ë³´í˜¸**: `src/middleware.ts`
- **DB ëª¨ë¸**: `prisma/schema.prisma` (User, Account, Session ëª¨ë¸)
- **ë¡œê·¸ì¸ UI**: `src/app/login/page.tsx`

### ğŸ”„ ì‘ë™ ì›ë¦¬
1.  **Prisma ì—°ë™**: `@auth/prisma-adapter`ë¥¼ ì‚¬ìš©í•˜ì—¬ NextAuth.jsì˜ ì„¸ì…˜ ë° ì‚¬ìš©ì ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ìë™ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
2.  **ìê²© ì¦ëª… ê¸°ë°˜ ì¸ì¦**: `CredentialsProvider`ë¥¼ í†µí•´ í‘œì¤€ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ ë°©ì‹ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì œê³µí•œ ë¹„ë°€ë²ˆí˜¸ëŠ” `bcrypt`ë¥¼ ì‚¬ìš©í•´ í•´ì‹±ëœ í›„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ê°’ê³¼ ë¹„êµë©ë‹ˆë‹¤.
3.  **ì„¸ì…˜ ê´€ë¦¬**: JWT(JSON Web Token) ì„¸ì…˜ ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ì•”í˜¸í™”ëœ í† í°ì´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°œê¸‰ë˜ë©°, ì´ í† í°ì—ëŠ” `user.id`ê°€ í¬í•¨ë˜ì–´ í›„ì† API ìš”ì²­ì—ì„œ ì‚¬ìš©ìë¥¼ ì‹ë³„í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
4.  **ê²½ë¡œ ë³´í˜¸**: `middleware.ts` íŒŒì¼ì€ `withAuth` í—¬í¼ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ê²½ë¡œ(`'/'`, `'/editor/:path*'`)ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•©ë‹ˆë‹¤. ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì´ ê²½ë¡œì— ì ‘ê·¼í•˜ë©´ ë¡œê·¸ì¸ í˜ì´ì§€(`/login`)ë¡œ ìë™ ë¦¬ë””ë ‰ì…˜ë©ë‹ˆë‹¤.

### ğŸ”„ ì‘ë™ ì›ë¦¬ (ì‹¤ì œ ì½”ë“œ ê¸°ì¤€)

ì¸ì¦ì€ `middleware.ts`ì—ì„œì˜ ê²½ë¡œ ë³´í˜¸ì™€ `[...nextauth]/route.ts`ì—ì„œì˜ ìê²© ì¦ëª… í™•ì¸ì„ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

```typescript
// 1. ë¯¸ë“¤ì›¨ì–´ê°€ íŠ¹ì • ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´
// íŒŒì¼: src/middleware.ts

import { withAuth } from "next-auth/middleware"

// withAuth í—¬í¼ë¥¼ ì‚¬ìš©, ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
export default withAuth({
  pages: {
    signIn: "/login",
  },
})

// ë¯¸ë“¤ì›¨ì–´ë¥¼ ì ìš©í•  ê²½ë¡œ ëª©ë¡
export const config = { 
  matcher: [
    "/",
    "/editor/:path*",
  ],
}


// 2. ì‚¬ìš©ìê°€ /login í˜ì´ì§€ì—ì„œ í¼ì„ ì œì¶œí•˜ë©´ NextAuth ì—”ë“œí¬ì¸íŠ¸ê°€ ì²˜ë¦¬
// 3. CredentialsProviderì˜ authorize í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ ìê²© ì¦ëª…ì„ ê²€ì¦
// íŒŒì¼: src/app/api/auth/[...nextauth]/route.ts

export const authOptions: AuthOptions = {
  adapter: PrismaAdapter(prisma),
  providers: [
    CredentialsProvider({
      name: "Credentials",
      credentials: { /* ... */ },
      async authorize(credentials) {
        if (!credentials?.email || !credentials.password) {
          return null;
        }

        // 4. Prismaë¥¼ í†µí•´ DBì—ì„œ ì‚¬ìš©ì ì¡°íšŒ
        const user = await prisma.user.findUnique({
          where: { email: credentials.email },
        });

        if (!user || !user.password) {
          return null;
        }

        // 5. bcrypt.compareë¡œ ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ ê²€ì¦
        const isPasswordValid = await bcrypt.compare(
          credentials.password,
          user.password
        );

        if (!isPasswordValid) {
          return null;
        }
        
        // 6. ê²€ì¦ ì„±ê³µ ì‹œ, ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
        return user;
      },
    }),
  ],
  // ... session, pages ì„¤ì • ...
};

// 7. ê²€ì¦ ì„±ê³µ í›„ JWT ì„¸ì…˜ í† í°ì´ ìƒì„±ë˜ì–´ í´ë¼ì´ì–¸íŠ¸ ì¿ í‚¤ì— ì €ì¥ë¨
```

---

## 16. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë° í˜ì´ì§€ ì˜ì†ì„± (Prisma & API)

ì‚¬ìš©ìê°€ ì›¹ ë¹Œë”ì—ì„œ ìƒì„±í•œ ëª¨ë“  í˜ì´ì§€ì™€ ê·¸ ë‚´ìš©ì€ Prismaì™€ REST APIë¥¼ í†µí•´ SQLite ë°ì´í„°ë² ì´ìŠ¤ì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

### ğŸ“ í•µì‹¬ íŒŒì¼
- **DB ìŠ¤í‚¤ë§ˆ**: `prisma/schema.prisma`
- **í˜ì´ì§€ ìƒì„±/ëª©ë¡ ì¡°íšŒ API**: `src/app/api/pages/route.ts`
- **í˜ì´ì§€ ê°œë³„ CRUD API**: `src/app/api/pages/[id]/route.ts`

### ğŸ—ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (Prisma)
- **`User` ëª¨ë¸**: ì‚¬ìš©ì ê³„ì • ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. (id, name, email, password ë“±)
- **`Page` ëª¨ë¸**: ìƒì„±ëœ ê° ì›¹ í˜ì´ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
    - `id`: í˜ì´ì§€ì˜ ê³ ìœ  ì‹ë³„ì.
    - `userId`: í˜ì´ì§€ë¥¼ ìƒì„±í•œ ì‚¬ìš©ìì˜ ID (`User` ëª¨ë¸ê³¼ ê´€ê³„ í˜•ì„±).
    - `content` (`Json` íƒ€ì…): **ì´ ì‹œìŠ¤í…œì˜ í•µì‹¬**. ì—ë””í„°ì˜ ëª¨ë“  ìƒíƒœ(ì—˜ë¦¬ë¨¼íŠ¸ ëª©ë¡, ìœ„ì¹˜, ìŠ¤íƒ€ì¼, ë‚´ìš©, ë ˆì´ì•„ì›ƒ ì„¤ì • ë“±)ê°€ í¬í•¨ëœ **ê±°ëŒ€í•œ JSON ê°ì²´**ê°€ ì´ í•„ë“œ í•˜ë‚˜ì— í†µì§¸ë¡œ ì €ì¥ë©ë‹ˆë‹¤. ì´ëŠ” ì„œë²„ ë“œë¦¬ë¸ UI(SDUI)ì™€ í˜ì´ì§€ ë Œë”ë§ì˜ ì›ì²œ ë°ì´í„°ê°€ ë©ë‹ˆë‹¤.

### ğŸ”„ í˜ì´ì§€ CRUD API
í”„ë¡œì íŠ¸ëŠ” í‘œì¤€ RESTful API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ í˜ì´ì§€ ë°ì´í„°ì˜ ìƒì„±, ì¡°íšŒ, ì—…ë°ì´íŠ¸, ì‚­ì œ(CRUD)ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ëª¨ë“  APIëŠ” `getServerSession`ì„ í†µí•´ ìš”ì²­ì´ ì¸ì¦ë˜ì—ˆëŠ”ì§€, ê·¸ë¦¬ê³  í•´ë‹¹ í˜ì´ì§€ì— ëŒ€í•œ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

- **`POST /api/pages`**: (Create) ìƒˆ í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì¸ì¦ëœ ì‚¬ìš©ìì˜ `userId`ì™€ ì—ë””í„°ì˜ ì´ˆê¸° ìƒíƒœë¥¼ `content` í•„ë“œì— ë‹´ì•„ DBì— ì €ì¥í•©ë‹ˆë‹¤.
- **`GET /api/pages`**: (Read) í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì†Œìœ í•œ ëª¨ë“  í˜ì´ì§€ì˜ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
- **`GET /api/pages/[id]`**: (Read) íŠ¹ì • IDë¥¼ ê°€ì§„ í˜ì´ì§€ì˜ `content` ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. ì´ APIëŠ” ì£¼ë¡œ `preview` í˜ì´ì§€ì—ì„œ ìµœì¢… ê²°ê³¼ë¬¼ì„ ë Œë”ë§í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
- **`PUT /api/pages/[id]`**: (Update) ì—ë””í„°ì—ì„œ í˜ì´ì§€ë¥¼ ìˆ˜ì •í•œ í›„ 'ì €ì¥'í•  ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤. ìš”ì²­ ë³¸ë¬¸ì— ë‹´ê¸´ ìµœì‹  `content` JSONìœ¼ë¡œ DBë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. `upsert`ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ê°€ ì—†ìœ¼ë©´ ìƒì„±í•˜ëŠ” ë¡œì§ë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- **`DELETE /api/pages/[id]`**: (Delete) íŠ¹ì • í˜ì´ì§€ë¥¼ DBì—ì„œ ì‚­ì œí•©ë‹ˆë‹¤.

### ğŸ¯ ë°ì´í„° í”Œë¡œìš° (í˜ì´ì§€ ì €ì¥)
```
1. ì‚¬ìš©ìê°€ ì—ë””í„°ì—ì„œ í˜ì´ì§€ ë‚´ìš©ì„ ìˆ˜ì •í•˜ê³  'ì €ì¥' ë²„íŠ¼ í´ë¦­
   â”‚
   â””â”€> 2. í´ë¼ì´ì–¸íŠ¸, í˜„ì¬ ì—ë””í„°ì˜ ì „ì²´ ìƒíƒœë¥¼ JSONìœ¼ë¡œ ì§ë ¬í™”
         â”‚
         â””â”€> 3. PUT /api/pages/{pageId} APIì— JSON ë°ì´í„°ë¥¼ ë‹´ì•„ ìš”ì²­
               â”‚
               â”œâ”€> 4. ì„œë²„, ìš”ì²­ í—¤ë”ì˜ ì„¸ì…˜ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì¦ ë° ID íšë“
               â”‚
               â”œâ”€> 5. DBì—ì„œ í•´ë‹¹ pageIdì˜ ì†Œìœ ìê°€ í˜„ì¬ ì‚¬ìš©ìì¸ì§€ í™•ì¸ (ë³´ì•ˆ ê²€ì‚¬)
               â”‚
               â””â”€> 6. ê²€ì¦ í†µê³¼ ì‹œ, `prisma.page.update` ì‹¤í–‰í•˜ì—¬ `content` í•„ë“œë¥¼ ìƒˆ JSONìœ¼ë¡œ ë®ì–´ì”€
   â”‚
   â””â”€> 7. ì„œë²„, ì„±ê³µ ì‘ë‹µ ë°˜í™˜
```